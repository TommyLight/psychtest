<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>90题心理测验 - 探索你的内心世界</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6b8cbc;
            --accent-color: #ff7e5f;
            --light-color: #f5f7fa;
            --dark-color: #2c3e50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--dark-color);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
            min-height: 400px;
        }
        
        .question-container {
            text-align: center;
        }
        
        .question {
            margin-bottom: 30px;
        }
        
        .question h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
            font-size: 1.4rem;
            line-height: 1.5;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .option {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: var(--light-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }
        
        .option:hover {
            background-color: #e6e9f0;
            transform: translateY(-2px);
        }
        
        .option.selected {
            background-color: #e1e8f7;
            border-left: 4px solid var(--primary-color);
        }
        
        .option input {
            margin-right: 12px;
            transform: scale(1.2);
        }
        
        .btn {
            padding: 12px 25px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .progress-container {
            margin-bottom: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            height: 10px;
        }
        
        .progress-bar {
            height: 100%;
            border-radius: 10px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .progress-text {
            text-align: center;
            margin-bottom: 10px;
            font-weight: bold;
            color: var(--dark-color);
        }
        
        .result {
            display: none;
            text-align: center;
            padding: 30px;
        }
        
        .result h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 2rem;
        }
        
        .result-content {
            background-color: var(--light-color);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            text-align: left;
            line-height: 1.6;
        }
        
        .result-score {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--dark-color);
        }
        
        .result-description {
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        
        .share-link {
            background-color: #f0f4ff;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            word-break: break-all;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: #777;
            font-size: 0.9rem;
        }
        
        @media (max-width: 600px) {
            .container {
                border-radius: 10px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .content {
                padding: 20px;
            }
            
            .btn-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>90题心理测验</h1>
            <p class="subtitle">深度探索你的性格特质、情绪模式和人际关系</p>
        </header>
        
        <div class="content" id="quiz-container">
            <div class="progress-text">已完成: <span id="progress-count">0</span>/90 题</div>
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            
            <div class="question-container" id="question-container">
                <!-- 当前题目将动态显示在这里 -->
            </div>
            
            <div class="btn-container">
                <button class="btn" id="prev-btn" disabled>上一题</button>
                <button class="btn" id="next-btn">下一题</button>
            </div>
        </div>
        
        <div class="result" id="result-container">
            <h2>你的个性分析报告</h2>
            
            <div class="result-content">
                <div class="result-score" id="score-display"></div>
                <div class="result-description" id="result-description"></div>
                <div id="personality-traits"></div>
            </div>
            
            <div class="share-link">
                <p>保存此链接可随时查看你的测试结果：</p>
                <p id="share-url"></p>
            </div>
            
            <button class="btn" id="retest-btn">重新测试</button>
        </div>
        
        <div class="footer">
            <p>本测验结果仅供参考，不代表专业心理评估</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const quizContainer = document.getElementById('quiz-container');
            const resultContainer = document.getElementById('result-container');
            const questionContainer = document.getElementById('question-container');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const retestBtn = document.getElementById('retest-btn');
            const scoreDisplay = document.getElementById('score-display');
            const resultDescription = document.getElementById('result-description');
            const personalityTraits = document.getElementById('personality-traits');
            const shareUrl = document.getElementById('share-url');
            const progressCount = document.getElementById('progress-count');
            const progressBar = document.getElementById('progress-bar');
            
            // 当前题目索引
            let currentQuestionIndex = 0;
            
            // 用户答案数组
            let userAnswers = Array(90).fill(null);
            
            // 生成90道题目
            const questions = generateQuestions();
            
            // 简单映射加密函数
            function encrypt(text) {
                const mapping = {
                    'a': 'z',
                    'b': 'w',
                    'c': 'a',
                    'd': '0'
                };
                
                let result = '';
                for (let i = 0; i < text.length; i++) {
                    result += mapping[text[i]];
                }
                return result;
            }
            
            // 简单映射解密函数
            function decrypt(text) {
                const reverseMapping = {
                    'z': 'a',
                    'w': 'b',
                    'a': 'c',
                    '0': 'd'
                };
                
                let result = '';
                for (let i = 0; i < text.length; i++) {
                    result += reverseMapping[text[i]];
                }
                return result;
            }
            
            // 生成90道题目数据
            function generateQuestions() {
                const questionTemplates = [
                    "我通常感到 {option}",
                    "在社交场合中，我 {option}",
                    "当面对压力时，我 {option}",
                    "对于新环境，我 {option}",
                    "在做决定时，我 {option}",
                    "我对待工作的态度是 {option}",
                    "在人际关系中，我 {option}",
                    "关于未来，我 {option}",
                    "面对批评，我 {option}",
                    "我通常的情绪状态是 {option}",
                    "在团队中，我 {option}",
                    "我处理冲突的方式是 {option}",
                    "对于规则和制度，我 {option}",
                    "在空闲时间，我 {option}",
                    "我对待金钱的态度是 {option}",
                    "面对挑战，我 {option}",
                    "我学习新知识的方式是 {option}",
                    "在表达自己时，我 {option}",
                    "我对待健康的态度是 {option}",
                    "对于艺术和美感，我 {option}"
                ];
                
                const optionSets = [
                    ["非常积极", "比较积极", "中性", "比较消极"],
                    ["主动与人交流", "等待别人接近", "根据情况而定", "尽量避免交流"],
                    ["冷静分析问题", "寻求他人帮助", "感到焦虑不安", "暂时逃避问题"],
                    ["感到兴奋好奇", "谨慎观察", "有些紧张", "希望保持原状"],
                    ["理性分析利弊", "听从直觉", "征求他人意见", "犹豫不决"],
                    ["追求完美", "尽力而为", "完成任务即可", "能拖则拖"],
                    ["容易建立亲密关系", "需要时间建立信任", "保持一定距离", "避免深入交往"],
                    ["充满期待", "有些担忧", "顺其自然", "感到焦虑"],
                    ["认真反思", "感到受伤", "辩解反驳", "忽视不理"],
                    ["快乐满足", "平静稳定", "有些低落", "焦虑不安"],
                    ["喜欢领导", "积极参与", "跟随他人", "避免参与"],
                    ["直接面对", "寻求妥协", "回避冲突", "情绪爆发"],
                    ["严格遵守", "灵活运用", "有时打破", "经常无视"],
                    ["计划安排", "随心所欲", "被动接受", "无所事事"],
                    ["精打细算", "适度消费", "偶尔挥霍", "经常超支"],
                    ["积极面对", "谨慎尝试", "有些退缩", "直接放弃"],
                    ["系统学习", "实践探索", "需要指导", "缺乏动力"],
                    ["直言不讳", "委婉表达", "有所保留", "很少表达"],
                    ["非常重视", "比较注意", "偶尔关注", "很少关心"],
                    ["非常敏感", "比较欣赏", "一般感受", "不太在意"]
                ];
                
                let questions = [];
                for (let i = 1; i <= 90; i++) {
                    const templateIndex = (i - 1) % questionTemplates.length;
                    const optionIndex = (i - 1) % optionSets.length;
                    
                    const questionText = questionTemplates[templateIndex].replace('{option}', '');
                    const options = optionSets[optionIndex];
                    
                    questions.push({
                        id: i,
                        text: questionText,
                        options: options
                    });
                }
                
                return questions;
            }
            
            // 显示当前题目
            function showCurrentQuestion() {
                const question = questions[currentQuestionIndex];
                
                let questionHTML = `
                    <div class="question">
                        <h3>${question.id}. ${question.text}</h3>
                    </div>
                    <div class="options">
                `;
                
                question.options.forEach((option, index) => {
                    const optionLetter = ['a', 'b', 'c', 'd'][index];
                    const isSelected = userAnswers[currentQuestionIndex] === optionLetter;
                    
                    questionHTML += `
                        <label class="option ${isSelected ? 'selected' : ''}">
                            <input type="radio" name="current-question" value="${optionLetter}" ${isSelected ? 'checked' : ''}>
                            ${option}
                        </label>
                    `;
                });
                
                questionHTML += `</div>`;
                
                questionContainer.innerHTML = questionHTML;
                
                // 更新按钮状态
                prevBtn.disabled = currentQuestionIndex === 0;
                nextBtn.textContent = currentQuestionIndex === questions.length - 1 ? '查看结果' : '下一题';
                
                // 更新进度
                updateProgress();
                
                // 添加选项点击事件
                document.querySelectorAll('.option').forEach(option => {
                    option.addEventListener('click', function() {
                        const radio = this.querySelector('input[type="radio"]');
                        radio.checked = true;
                        
                        // 移除同一问题中其他选项的选中状态
                        document.querySelectorAll('.option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        
                        // 添加当前选项的选中状态
                        this.classList.add('selected');
                        
                        // 保存答案
                        userAnswers[currentQuestionIndex] = radio.value;
                        
                        // 更新进度
                        updateProgress();
                    });
                });
            }
            
            // 更新进度条
            function updateProgress() {
                const answeredCount = userAnswers.filter(answer => answer !== null).length;
                const progress = (answeredCount / questions.length) * 100;
                progressBar.style.width = `${progress}%`;
                progressCount.textContent = answeredCount;
            }
            
            // 上一题按钮事件
            prevBtn.addEventListener('click', function() {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    showCurrentQuestion();
                }
            });
            
            // 下一题/查看结果按钮事件
            nextBtn.addEventListener('click', function() {
                // 检查当前题目是否已回答
                if (userAnswers[currentQuestionIndex] === null) {
                    alert('请选择答案后再继续！');
                    return;
                }
                
                if (currentQuestionIndex < questions.length - 1) {
                    currentQuestionIndex++;
                    showCurrentQuestion();
                } else {
                    // 到达最后一题，显示结果
                    showResults();
                }
            });
            
            // 检查URL参数，如果有答案则显示结果
            const urlParams = new URLSearchParams(window.location.search);
            const encodedAnswers = urlParams.get('r');
            if (encodedAnswers) {
                try {
                    const answers = decrypt(encodedAnswers);
                    if (answers.length === 90) {
                        userAnswers = answers.split('');
                        showResults();
                    }
                } catch (e) {
                    console.error('解析答案时出错:', e);
                }
            }
            
            // 重新测试按钮事件
            retestBtn.addEventListener('click', function() {
                // 清除URL参数
                window.history.replaceState({}, '', window.location.pathname);
                
                // 重置数据
                currentQuestionIndex = 0;
                userAnswers = Array(90).fill(null);
                
                // 显示测验，隐藏结果
                quizContainer.style.display = 'block';
                resultContainer.style.display = 'none';
                
                // 显示第一题
                showCurrentQuestion();
            });
            
            // 显示结果函数
            function showResults() {
                // 计算得分和生成报告
                const score = calculateScore();
                const report = generateReport(score);
                
                // 更新结果页面
                scoreDisplay.textContent = `你的心理特质得分: ${score}/360`;
                resultDescription.textContent = report.description;
                personalityTraits.innerHTML = report.traits;
                
                // 加密答案并生成分享链接
                const answerStr = userAnswers.join('');
                const encodedAnswers = encrypt(answerStr);
                const newUrl = window.location.origin + window.location.pathname + '?r=' + encodedAnswers;
                window.history.replaceState({}, '', newUrl);
                
                // 显示分享链接
                shareUrl.textContent = newUrl;
                
                // 显示结果，隐藏测验
                quizContainer.style.display = 'none';
                resultContainer.style.display = 'block';
            }
            
            // 计算得分函数
            function calculateScore() {
                let score = 0;
                
                // 为每个答案分配分数
                const scoring = {
                    'a': 4,
                    'b': 3,
                    'c': 2,
                    'd': 1
                };
                
                for (let i = 0; i < userAnswers.length; i++) {
                    score += scoring[userAnswers[i]];
                }
                
                return score;
            }
            
            // 生成报告函数
            function generateReport(score) {
                let description = '';
                let traits = '<h3>你的主要心理特质：</h3><ul>';
                
                // 分析不同维度的得分
                const dimensionScores = {
                    '外向性': 0,
                    '情绪稳定性': 0,
                    '开放性': 0,
                    '宜人性': 0,
                    '尽责性': 0
                };
                
                // 假设每18题对应一个维度
                for (let i = 0; i < 90; i++) {
                    const dimensionIndex = Math.floor(i / 18);
                    const dimensionNames = ['外向性', '情绪稳定性', '开放性', '宜人性', '尽责性'];
                    const dimension = dimensionNames[dimensionIndex];
                    
                    const answerValue = userAnswers[i];
                    const answerScore = {'a': 4, 'b': 3, 'c': 2, 'd': 1}[answerValue];
                    
                    dimensionScores[dimension] += answerScore;
                }
                
                // 生成描述
                if (score >= 300) {
                    description = '你是一个心理特质非常积极的人。你在各个维度上都表现出较高的水平，拥有良好的心理适应能力和积极的生活态度。';
                } else if (score >= 240) {
                    description = '你的心理特质总体较为积极。你在多个维度上表现良好，拥有较好的心理适应能力，但在某些方面还有提升空间。';
                } else if (score >= 180) {
                    description = '你的心理特质处于中等水平。你在某些方面表现良好，但在其他方面可能需要更多的关注和发展。';
                } else {
                    description = '你的心理特质在某些方面可能需要更多关注。建议你在日常生活中多关注自己的心理健康，必要时可以寻求专业帮助。';
                }
                
                // 添加维度分析
                traits += `<li><strong>外向性得分：${dimensionScores['外向性']}/72</strong> - 这反映了你在社交活动中的活跃程度和能量水平</li>`;
                traits += `<li><strong>情绪稳定性得分：${dimensionScores['情绪稳定性']}/72</strong> - 这反映了你情绪反应的强度和应对压力的能力</li>`;
                traits += `<li><strong>开放性得分：${dimensionScores['开放性']}/72</strong> - 这反映了你对新经验、新想法和变化的接受程度</li>`;
                traits += `<li><strong>宜人性得分：${dimensionScores['宜人性']}/72</strong> - 这反映了你在人际关系中的合作性、同情心和信任度</li>`;
                traits += `<li><strong>尽责性得分：${dimensionScores['尽责性']}/72</strong> - 这反映了你的组织性、责任感和自律性</li>`;
                
                traits += '</ul>';
                
                // 根据最高分的维度给出建议
                let maxDimension = '';
                let maxScore = 0;
                for (const [dimension, score] of Object.entries(dimensionScores)) {
                    if (score > maxScore) {
                        maxScore = score;
                        maxDimension = dimension;
                    }
                }
                
                traits += `<h3>你的最强特质：${maxDimension}</h3>`;
                traits += `<p>根据测试结果，你在${maxDimension}方面表现最为突出。这可能是你性格中的核心优势，可以在生活和工作中善加利用。</p>`;
                
                return {
                    description: description,
                    traits: traits
                };
            }
            
            // 初始化测验 - 显示第一题
            showCurrentQuestion();
        });
    </script>
</body>
</html>
